{
  "hash": "28554f1ebc5b594fe777cdbe0a925782",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat:\n  live-revealjs:\n    theme: default\n    slideNumber: true\n    chalkboard:\n      theme: whiteboard\n      boardmarker-width: 5\n      buttons: true\ntitle: \"3. Seminar: Ereignisdaten\"\nsubtitle: \"Fortgeschrittene quantitative Methoden <br> Wintersemester 2024-2025\"\nauthor: \"Daria Tisch\"\nwebr:\n  cell-options:\n    autorun: true\n    fig-width: 11\n    fig-height: 5\n  # webr:\n  # packages:\n  #   - dplyr\n  #   - ggplot2\neditor: visual\nengine: knitr\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# Ereignisdaten\n\n## Heutige Sitzung {.smaller}\n\n1.  Datenerhebung in den Sozialwissenschaften\n2.  Probleme und Vorteile nicht-reaktiver Daten\n3.  Ereignisdaten\n4.  Ereignisdatenanalyse\n\nPflichtlektüre:\n\n-   Watteler, O. (2022). Daten in den Sozialwissenschaften. In Forschungsstrategien in den Sozialwissenschaften (pp. 225-256). Springer VS, Wiesbaden.\n\n-   Blossfeld, H. P. (2010). Survival- und Ereignisanalyse. In Handbuch der sozialwissenschaftlichen Datenanalyse (pp. 995-1016). VS Verlag für Sozialwissenschaften.\n\n# Datenerhebung in den Sozialwissenschaften\n\n## Reaktive versus nicht-reaktive Daten {.smaller}\n\n| Reaktive Messung | Nicht-reaktive Messung |\n|----|----|\n| Umfragedaten | Amtliche Statistik / Registerdaten |\n| Laborexperimente | Verhaltensspuren / digital trace data: z.B. Social Media, Smartphone, Wearables |\n|  | Journalistische Datensätze: z. B. Reichenlisten, WikiLeaks |\n\n**Reaktive Daten**: Einfluss des Messvorgangs auf die Reaktionen (=Daten) von Untersuchungspersonen, für wissenschaftliche Zwecke erhoben\n\n**Nicht-reaktive Daten**: nicht mit dem Ziel der Verwendung für sozialwissenschaftliche Forschung generiert, sondern als Folge alltäglichen Verhaltens von Menschen\n\n::: notes\nUmfragen Face-to-face interview; Computer-assisted (CAPI/CAMI); Telephone interview (CATI); Self-administered questionnaire: Paper; Self-administered questionnaire: Web-based (CAWI); Web-based interview; Face-to-face interview: Paper-and-pencil (PAPI)\n:::\n\n# Probleme und Vorteile nicht-reaktiver Daten\n\n## Probleme nicht-reaktiver Daten {.smaller}\n\n::: incremental\n-   Generalisierbarkeit: Stichprobenprobleme / selektive Auswahl: Social Media Nutzer Over/Undercoverage (doppelte Accounts)\n\n-   Archivierung/Verfügbarkeit des Materials: (plötzliche) Einschränkungen bei Facebook, Twitter API etc.\n\n-   Zugang zum Material: Private Organisationen, Akteneinsicht, Zugang zu historischen Archiven\n\n-   Datenschutz: Anonymisierungsproblematik, Einverständnis\n\n-   Validität: Objektive Realität = subjektive Realität? („produzierte“ Daten; Facebook-“Freunde“) Artefakte (Ironie; Nutzer≠Menschen)\n\n-   Keine einheitliche Definition: unkontrollierbare Datenherkunft\n:::\n\n## Vorteile prozess-produzierter Daten (gegenüber reaktiver Daten)\n\n::: incremental\n-   Zielpersonen können per Interviews nicht erreicht werden (oder eine sehr niedrige response rate wird erwartet)\n-   Das soziale Phänomen liegt in der Vergangenheit (Erinnerungseffekte)\n-   Es wird ein falsches/verzerrtes Antwortverhalten erwartet: Sensible/heikle Fragen; soziale Erwünschtheit\n:::\n\n# Ereignisdaten\n\n## Ereignisdaten\n\n-   dokumentieren spezifische, zeitlich und/oder räumlich begrenzte Ereignisse\n-   Untersuchung von **Zustandswechseln**\n-   Zustände sind abzählbar\n-   Ereignisse können zu beliebigen Zeiten stattfinden\n\n## Beispiel: Biographie der Partnerschaft\n\n![Biographie der Partnerschaft](images/partner.png)\n\n## Beispiel: Arbeitslosigkeit\n\n![Arbeitslosigkeit](images/job.png)\n\n## Beispiel: Sterblichkeit einer Geburtskohorte\n\n![Sterblichkeit einer Geburtskohorte](images/death.png)\n\n## Beispiele: Überleben von start-up Firmen\n\n![Überleben von neu gegründeten Unternehmen](images/start_up.png)\n\n# Ereignisdatenanalyse\n\n## Ziele der Ereignisdatenanalyse\n\n-   Analyse der Dauer bis zu bestimmten Ereignissen (Beschreibung)\n-   Welche Faktoren beeinflussen die Zeit bis zum Eintreten eines bestimmten Ereignisses? (Erklärung)\n\n## Anwendungsgebiete der Ereignisdatenanalyse {.smaller}\n\n-   Lebensverlaufsforschung\n-   Familiensoziologie: Entstehung von Partnerschaften, Heirat\n-   Arbeitsmarktsoziologie: Erwerbsverläufe, Eintritt in die Rente\n-   Migrationssoziologie: Wohnortswechsel\n\nFragestellungen:\n\n-   Welche Faktoren beeinflussen die Dauer der Arbeitslosigkeit bis zum Beginn einer neuen Erwerbstätigkeit?\n\n-   Welche Faktoren beeinflussen die Dauer bis zu einem Umzug an einen anderen Ort?\n\n## Grundbegriffe {.smaller}\n\n**Ereignis**:\n\n-   Zustandswechsel von einem diskreten Zustand in einen anderen\n-   Einfache Zuordnung: Berufseintritt, Verrentung, Erstberufung (Professur)\n-   Mehrfache Zuordnung: Kündigungen, Hochzeiten, Berufungen (Professur)\n\n**Episode**:\n\n-   Zeitintervall zwischen zwei Zuständen\n-   rechts-zensiert: Episoden zum Beobachtungsende noch nicht abgeschlossen\n-   links-zensiert: Informationen nur nach einem bestimmten Ereignis bekannt\n\n## Grundbegriffe {.smaller}\n\n![](images/clipboard-3637219421.png)\n\nAus: Windzio, M. (2013). Regressionsmodelle für Zustände und Ereignisse: Eine Einführung. Springer-Verlag, S. 88.\n\n## Grundbegriffe {.smaller}\n\n![](images/censor.png)\n\n## Grundbegriffe {.smaller}\n\n**Prozesszeit/Verweildauer**:\n\n-   Dauer der Episode (bis zum Eintreten des Ereignisses oder bis zur Zensierung)\n-   Nullpunkt wird definiert (z.B. Geburt, Jahr, Erste Arbeitslosigkeit)\n\n**Risikomenge**:\n\n-   Anzahl der Untersuchungseinheiten, die dem Zustandswechsel ausgesetzt sind\n\n## Analyseverfahren {.smaller}\n\n1.  Nicht-parametrische Verfahren (deskriptive Verfahren)\n    -   Keine Annahmen über Verteilung, nur über Wirkungsweisen von Variablen\n    -   Beispiel: Kaplan-Meier, Sterbetafelmethode\n2.  Parametrische Regressionsmodelle\n    -   Verlauf der Hazardrate (baseline hazard) wird spezifiziert\n    -   Kovariateneinflüsse werden spezifiziert\n    -   Beispiel: Exponentialmodell, Weibull-Modell, Gompertz-Modell\n3.  Semi-parametrische Regressionsmodelle\n    -   Verlauf der Hazardrate bleibt unspezifiziert\n    -   Kovariateneinflüsse werden spezifiziert\n    -   Beispiel: Cox-Regressionen\n\n## Analyseverfahren\n\nAnalyse erfolgt idR in 2 Schritten:\n\n-   Deskriptive Verfahren\n-   Multivariates Regressionsmodell\n\n# Los geht's\n\n## Package \"survival\"\n\nWir nutzen das R-Paket {survival} für unsere Ereignisdatenanalyse.\n\n\n\n::: {.cell setup='true' exercise='ex_1'}\n```{webr}\n#| echo: true\n#| setup: true\n#| exercise: ex_1\nlibrary(survival)\nlibrary(dplyr)\n\n# Datensätze, die im Package survival enthalten sind, anzeigen\ndata(package = \"survival\")\n\n# Lungenkrebsdatensatz als df speichern \ndf = lung\n```\n:::\n\n\n\n## Lungenkrebsdaten\n\nWir möchten das Überleben von PatientInnen mit fortgeschrittenem Lungenkrebs aus der \"North Central Cancer Treatment Group\" untersuchen. Schauen wir uns an, welche Variablen im Datensatz vorhanden sind:\n\n\n\n::: {.cell}\n```{webr}\nlibrary(survival)\n?lung     # Hilfe zu einer Funktion oder einem Objekt \n```\n:::\n\n\n\n## Datenaufbereitung\n\nWir brauchen für unsere Analyse 3 Variablen:\n\n-   dead (0: lebend, 1: tot)\n-   Karnofsky-Index (0: \\<=80 \\[niedrig\\], 1: \\>80 \\[hoch\\])\n-   time (Tage)\n\n\n\n::: {.cell setup='true' exercise='ex_1'}\n```{webr}\n#| setup: true\n#| exercise: ex_1\nlibrary(survival)\nlibrary(dplyr)\ndf = lung\n```\n:::\n\n::: {.cell exercise='ex_1'}\n```{webr}\n#| echo: true\n#| exercise: ex_1\n# Lungenkrebsdatensatz als df speichern \ndf = lung\nnames(df)\ndf <- df %>% \n  mutate(\n    ______ = recode(status, `1` = 0, `2` = 1),\n    ______ = recode(sex, `1` = 0, `2` = 1)\n  )\n\n```\n:::\n\n\n\n:::: {.solution exercise=\"ex_1\"}\n::: {.callout-tip title=\"Solution\" collapse=\"true\"}\n**Lösung:**\n\n``` r\nnames(df)\ndf <- df %>% \n  mutate(\n    dead = recode(status, `1` = 0, `2` = 1),\n    karnofsky_hoch = ifelse(ph.karno >80, 1, 0)\n  )\n```\n:::\n::::\n\n## Erstellen von \"survival objects\"\n\nDie Surv() Funktion aus dem the {survival} Paket erstellt ein \"survival object\". Schauen wir und die ersten 10 Beobachtungen an:\n\n::: panel-tabset\n## Output\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  306   455  1010+  210   883  1022+  310   361   218   166 \n```\n\n\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(dplyr)\nlibrary(ggsurvfit)\n\ndf = lung\ndf <- df %>% \n  mutate(\n    dead = recode(status, `1` = 0, `2` = 1),\n    karnofsky_hoch = ifelse(ph.karno >80, 1, 0)\n  )\nSurv(df$time, df$dead)[1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  306   455  1010+  210   883  1022+  310   361   218   166 \n```\n\n\n:::\n:::\n\n\n:::\n\n## Erstellen von Kaplan-Meier Kurven {.smaller .scrollable}\n\nKaplan-Meier-Methode gängigste Methode zur Visualisierung von Überlebenswahrscheinlichkeiten\n\n::: panel-tabset\n## Output\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](3_seminar_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvfit2(Surv(time, dead) ~ 1, data = df) %>% \n  ggsurvfit() +\n  labs(\n    x = \"Days\",\n    y = \"Overall survival probability\"\n  )+ \n  add_confidence_interval() +\n  add_risktable()\n```\n\n::: {.cell-output-display}\n![](3_seminar_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n:::\n\n## Erstellen von Kaplan-Meier Kurven {.smaller .scrollable}\n\nProbiert selbst:\n\n\n\n::: {.cell setup='true' exercise='ex_2'}\n```{webr}\n#| setup: true\n#| exercise: ex_2\nlibrary(survival)\nlibrary(dplyr)\ndf = lung\ndf <- df %>% \n  mutate(\n    dead = recode(status, `1` = 0, `2` = 1),\n    karnofsky_hoch = ifelse(ph.karno >80, 1, 0)\n  )\n```\n:::\n\n::: {.cell exercise='ex_2'}\n```{webr}\n#| echo: true\n#| exercise: ex_2\n\nlibrary(survival)\nlibrary(dplyr)\nlibrary(ggsurvfit)\n\nsurvfit2(Surv(______, ______) ~ 1, data = df) %>% \n  ggsurvfit() +\n  labs(\n    x = \"Days\",\n    y = \"Overall survival probability\"\n  )+ \n  add_confidence_interval() +\n  add_risktable()\n\n```\n:::\n\n\n\n:::: {.solution exercise=\"ex_2\"}\n::: {.callout-tip title=\"Solution\" collapse=\"true\"}\n**Lösung:**\n\n``` r\nlibrary(survival)\nlibrary(dplyr)\nlibrary(ggsurvfit)\n\nsurvfit2(Surv(time, dead) ~ 1, data = df) %>% \n  ggsurvfit() +\n  labs(\n    x = \"Days\",\n    y = \"Overall survival probability\"\n  )+ \n  add_confidence_interval() +\n  add_risktable()\n```\n:::\n::::\n\n## Erstellen von Kaplan-Meier Kurven nach Karnofsky-Index {.smaller .scrollable}\n\nUnterscheiden sich PatientInnen mit niedrigem oder hohem Karnofsky-Index?\n\n::: panel-tabset\n## Output\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](3_seminar_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvfit2(Surv(time, dead) ~ karnofsky_hoch, data = df) %>% \n  ggsurvfit() +\n  labs(\n    x = \"Tage\",\n    y = \"Überlebenswahrscheinlichkeit\",\n    color = \"Karnofsky-Index\"\n  )+ \n  add_confidence_interval() +\n  add_risktable() + \n scale_color_manual(values = c('darkblue', 'pink'),  labels = c(\"<=80\", \">80\") ) +\n  scale_fill_manual(values = c('darkblue', 'pink'),  labels = c(\"<=80\", \">80\") ) +\n  theme_minimal() + guides(fill = \"none\")\n```\n\n::: {.cell-output-display}\n![](3_seminar_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n:::\n\n## Cox Proportional Hazards Model {.smaller .scrollable}\n\n$h(t) = h_0(t)*exp(X\\beta)$\n\n-   Abhängige Variable: $h(t)$\n    -   Hazardrate (*hazard*)\n    -   „momentane Neigung einer Untersuchungseinheit, im nächsten Augenblick ein Ereignis zu erleben“\n-   Basline-Hazard $h_0(t)$\n    -   nicht-parametrisch geschätzt (keine Verteilungsannahme)\n    -   Konstante steckt in der Baseline Hazardrate\n-   Regressionskoeffizient $\\beta$:\n    -   $X$ können proportionale Änderungen der Hazardrate bewirken\n    -   Veränderung der log. Hazardrate, wenn sich unabhängige Variable um eine Einheit erhöht\n    -   Berechnung der Hazard-Ratio: $HR = exp(\\beta)$\n    -   HR \\< 1: verringertes Sterberisiko\n    -   HR \\> 1: erhöhtes Sterberisiko\n\n## Cox Proportional Hazards Model {.smaller .scrollable}\n\n$h(t) = h_0(t)*exp(X\\beta)$\n\n-   Partial-Likelihood-Methode\n    -   Genauer Zeitpunkt des Ereignisses irrelevant, sondern Reihenfolgen\n    -   Keine Verteilungsannahme über die Hazardrate\n-   Bedindung: Proportionalitätsannahme muss erfüllt sein (da proportionalle Änderungen der Hazardrate geschätzt werden)\n\n::: notes\nProportionalitätsannahme: Hazard Ratio (das Verhältnis der Hazard Rates zwischen zwei Gruppen) bleibt im Laufe der Zeit konstant\n:::\n\n## Cox Proportional Hazards Model {.smaller .scrollable}\n\n::: panel-tabset\n## Output\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(time, dead) ~ karnofsky_hoch, data = df)\n\n  n= 227, number of events= 164 \n   (1 observation deleted due to missingness)\n\n                  coef exp(coef) se(coef)     z Pr(>|z|)   \nkarnofsky_hoch -0.4436    0.6417   0.1596 -2.78  0.00544 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nkarnofsky_hoch    0.6417      1.558    0.4694    0.8774\n\nConcordance= 0.569  (se = 0.022 )\nLikelihood ratio test= 7.88  on 1 df,   p=0.005\nWald test            = 7.73  on 1 df,   p=0.005\nScore (logrank) test = 7.85  on 1 df,   p=0.005\n```\n\n\n:::\n:::\n\n\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sjPlot)\nmodel1 = coxph(Surv(time, dead) ~ karnofsky_hoch, data = df)\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\ncoxph(formula = Surv(time, dead) ~ karnofsky_hoch, data = df)\n\n  n= 227, number of events= 164 \n   (1 observation deleted due to missingness)\n\n                  coef exp(coef) se(coef)     z Pr(>|z|)   \nkarnofsky_hoch -0.4436    0.6417   0.1596 -2.78  0.00544 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nkarnofsky_hoch    0.6417      1.558    0.4694    0.8774\n\nConcordance= 0.569  (se = 0.022 )\nLikelihood ratio test= 7.88  on 1 df,   p=0.005\nWald test            = 7.73  on 1 df,   p=0.005\nScore (logrank) test = 7.85  on 1 df,   p=0.005\n```\n\n\n:::\n:::\n\n\n:::\n\n## Cox Proportional Hazards Model, Interpretation {.smaller .scrollable}\n\n::: panel-tabset\n## Interpretation\n\nDas Risiko zu sterben (in jedem kurzen Zeitraum) ist höher bei Personen mit einem Karnofsky-Index kleiner-gleich 80 im Vergleich zu Personen mit einem Karnofsky-Index über 80.\n\n**Hazard-Ratio**: Personen mit einem Karnofsky-Index über 80 haben ein 36% geringeres Risiko zu sterben (in jedem kurzen Zeitraum) als Personen mit einem Karnofsky-Index unter/gleich 80. Oder: Personen mit einem Karnofsky-Index über 80 haben ein 0.64 mal so hohes Risiko zu sterben (in jedem kurzen Zeitraum) wie Personen mit einem Karnofsky-Index unter/gleich 80.\n\n-   HR \\< 1: verringertes Sterberisiko\n-   HR \\> 1: erhöhtes Sterberisiko\n\n## Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sjPlot)\nmodel1 = coxph(Surv(time, dead) ~ karnofsky_hoch, data = df)\ntab_model(model1,\n          show.ci = FALSE, p.style = \"stars\",\n          string.se = \"se\", string.est = \"HR\",\n          string.pred = \" \")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"1\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">Surv(time,dead)</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \"> </td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">HR</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">karnofsky hoch</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.64 <sup>**</sup></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"1\">227</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> Nagelkerke</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"1\">0.034</td>\n</tr>\n<tr>\n<td colspan=\"2\" style=\"font-style:italic; border-top:double black; text-align:right;\">* p&lt;0.05&nbsp;&nbsp;&nbsp;** p&lt;0.01&nbsp;&nbsp;&nbsp;*** p&lt;0.001</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n## Ende\n\n-   Dieser Foliensatz profitierte in großen Teilen von ehemaligen Veranstaltungen von Isabel Habicht sowie von Hans-Jürgen Andreß\n\n-   Weitere Literatur:\n\n    -   https://ehar.se/r/ehar2/\n    -   https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html#Comparing_survival_times_between_groups\n",
    "supporting": [
      "3_seminar_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}