<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.6.40" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Daria Tisch" />

<title>3. Übungsblatt (Ereignisdatenanalyse) – Fortgeschrittene quantitative Methoden</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs"></h1>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" role="link"
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Fortgeschrittene quantitative Methoden
      </a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/dariatisch/wup2024"  title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kursinformationen</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1"  role="navigation" aria-expanded="true">
 <span class="menu-text">Zeitplan und Dateien</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Übersicht</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/slides/1_seminar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 - Seminar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/slides/1_uebung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 - Übung</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/uebungen/1_uebungsblatt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 - Übungsblatt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/slides/2_seminar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 - Seminar  (Paneldaten)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/uebungen/2_uebungsblatt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 - Übungsblatt (Paneldaten)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/slides/3_seminar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 - Seminar  (Ereignisdaten)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/uebungen/3_uebungsblatt.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">3 - Übungsblatt (Ereignisdaten)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3. Übungsblatt (Ereignisdatenanalyse)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daria Tisch </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#organisation" id="toc-organisation"><span class="header-section-number">1</span> Organisation</a>
  <ul>
  <li><a href="#arbeitsverzeichnis-festsetzen" id="toc-arbeitsverzeichnis-festsetzen"><span class="header-section-number">1.1</span> Arbeitsverzeichnis festsetzen</a></li>
  <li><a href="#packages-installieren-und-laden" id="toc-packages-installieren-und-laden"><span class="header-section-number">1.2</span> Packages installieren und laden</a></li>
  <li><a href="#daten-einlesen" id="toc-daten-einlesen"><span class="header-section-number">1.3</span> Daten einlesen</a></li>
  </ul></li>
  <li><a href="#datenaufbereitung" id="toc-datenaufbereitung"><span class="header-section-number">2</span> Datenaufbereitung</a></li>
  <li><a href="#datenexploration" id="toc-datenexploration"><span class="header-section-number">3</span> Datenexploration</a>
  <ul>
  <li><a href="#anzahl-beobachtungen" id="toc-anzahl-beobachtungen"><span class="header-section-number">3.1</span> Anzahl Beobachtungen</a></li>
  <li><a href="#anzahl-frauen-und-männer" id="toc-anzahl-frauen-und-männer"><span class="header-section-number">3.2</span> Anzahl Frauen und Männer</a></li>
  <li><a href="#anzahl-personden-die-im-beobachtungszeitraum-gestorben-sind" id="toc-anzahl-personden-die-im-beobachtungszeitraum-gestorben-sind"><span class="header-section-number">3.3</span> Anzahl Personden, die im Beobachtungszeitraum gestorben sind</a></li>
  <li><a href="#kreuztabelle-geschlecht-und-überleben" id="toc-kreuztabelle-geschlecht-und-überleben"><span class="header-section-number">3.4</span> Kreuztabelle Geschlecht und Überleben</a></li>
  </ul></li>
  <li><a href="#ereignisdatenanalyse" id="toc-ereignisdatenanalyse"><span class="header-section-number">4</span> Ereignisdatenanalyse</a>
  <ul>
  <li><a href="#zensierung" id="toc-zensierung"><span class="header-section-number">4.1</span> Zensierung</a></li>
  <li><a href="#erste-10-fälle" id="toc-erste-10-fälle"><span class="header-section-number">4.2</span> Erste 10 Fälle</a></li>
  <li><a href="#kaplan-meier-kurve" id="toc-kaplan-meier-kurve"><span class="header-section-number">4.3</span> Kaplan-Meier-Kurve</a></li>
  <li><a href="#kaplan-meier-kurve-mit-ki" id="toc-kaplan-meier-kurve-mit-ki"><span class="header-section-number">4.4</span> Kaplan-Meier-Kurve mit KI</a></li>
  <li><a href="#kaplan-meier-kurve-mit-ki-und-risikotabelle" id="toc-kaplan-meier-kurve-mit-ki-und-risikotabelle"><span class="header-section-number">4.5</span> Kaplan-Meier-Kurve mit Ki und Risikotabelle</a></li>
  <li><a href="#schätzung-der-überlebensrate-nach-einem-jahr" id="toc-schätzung-der-überlebensrate-nach-einem-jahr"><span class="header-section-number">4.6</span> Schätzung der Überlebensrate nach einem Jahr</a></li>
  </ul></li>
  <li><a href="#überlebenszeit-im-median" id="toc-überlebenszeit-im-median"><span class="header-section-number">5</span> Überlebenszeit im Median</a></li>
  <li><a href="#kaplan-meier-kurve-nach-geschlecht" id="toc-kaplan-meier-kurve-nach-geschlecht"><span class="header-section-number">6</span> Kaplan-Meier-Kurve nach Geschlecht</a></li>
  <li><a href="#cox-proportional-hazards-model" id="toc-cox-proportional-hazards-model"><span class="header-section-number">7</span> Cox Proportional Hazards Model</a>
  <ul>
  <li><a href="#interpretiere-den-koeffizienten-von-female" id="toc-interpretiere-den-koeffizienten-von-female"><span class="header-section-number">7.1</span> Interpretiere den Koeffizienten von <em>female</em>:</a></li>
  </ul></li>
  <li><a href="#render" id="toc-render"><span class="header-section-number">8</span> Render</a></li>
  <li><a href="#weiterführende-literatur" id="toc-weiterführende-literatur"><span class="header-section-number">9</span> Weiterführende Literatur</a></li>
  </ul>
</nav>
<section id="organisation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Organisation</h1>
<section id="arbeitsverzeichnis-festsetzen" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span> Arbeitsverzeichnis festsetzen</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># set working directory</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/ti/Local/seafile/main/teaching/2024_wuppertal/studis/uebungen&quot;</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="packages-installieren-und-laden" class="level2" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span> Packages installieren und laden</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Packages</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="st">&quot;tidyverse&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="st">&quot;sjPlot&quot;</span>, <span class="co"># nice html tables</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="st">&quot;survival&quot;</span>, <span class="co"># survival analysis</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="st">&quot;ggsurvfit&quot;</span> <span class="co"># flexible time-to-event figures</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>) </span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="do">## Install uninstalled packages</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="fu">lapply</span>(pkgs[<span class="sc">!</span>(pkgs <span class="sc">%in%</span> <span class="fu">installed.packages</span>())], install.packages)</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="do">## Load all packages to library</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="fu">lapply</span>(pkgs, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</details>
</div>
</section>
<section id="daten-einlesen" class="level2" data-number="1.3">
<h2 data-number="1.3"><span class="header-section-number">1.3</span> Daten einlesen</h2>
<p>Wir arbeiten mit einem Datensatz, der Teil des R-Pakets {survival} ist. Bitte lasse Dir alle Datensätze des Pakets anzeigen und speichere den Datensatz lung als <em>df</em>.</p>
<p>Datensätze, die im Package survival enthalten sind, anzeigen:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">&quot;survival&quot;</span>)</span></code></pre></div>
</details>
</div>
<p><em>lung</em> Datensatz als <em>df</em> speichern:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Lungenkrebsdatensatz als df speichern </span></span>
<span id="cb4-2"><a href="#cb4-2"></a>df <span class="ot">=</span> lung</span></code></pre></div>
</details>
</div>
<p>Schaue Dir nun die Beschreibung des Datensatzes an:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>?lung</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>starte den http Server für die Hilfe fertig</code></pre>
</div>
</div>
<p>Der Datensatz enthält also Informationen zu PatientInnen der North Central Cancer Treatment Group.</p>
</section>
</section>
<section id="datenaufbereitung" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Datenaufbereitung</h1>
<p>In dieser Übung möchten wir untersuchen, ob es Unterschiede zwischen Männern und Frauen in der Überlebenszeit bei Lungenkrebs gibt.</p>
<p>Wir brauchen für unsere Analyse daher die folgenden 3 Variablen:</p>
<ul>
<li>dead (0: lebend, 1: tot)</li>
<li>female (0: männlich, 1: weiblich)</li>
<li>time (Tage)</li>
</ul>
<p>Bitte suche diese heraus oder erstelle sie.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="at">dead =</span> <span class="fu">recode</span>(status, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="at">female =</span> <span class="fu">recode</span>(sex, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a>  )</span></code></pre></div>
</details>
</div>
</section>
<section id="datenexploration" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Datenexploration</h1>
<section id="anzahl-beobachtungen" class="level2" data-number="3.1">
<h2 data-number="3.1"><span class="header-section-number">3.1</span> Anzahl Beobachtungen</h2>
<p>Wie viele Personen sind in dem Datensatz?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">length</span>(df<span class="sc">$</span>dead)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 228</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">nrow</span>(lung)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 228</code></pre>
</div>
</div>
</section>
<section id="anzahl-frauen-und-männer" class="level2" data-number="3.2">
<h2 data-number="3.2"><span class="header-section-number">3.2</span> Anzahl Frauen und Männer</h2>
<p>Wie viele Frauen und Männer sind jewils in dem Datensatz?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">table</span>(df<span class="sc">$</span>female)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
138  90 </code></pre>
</div>
</div>
</section>
<section id="anzahl-personden-die-im-beobachtungszeitraum-gestorben-sind" class="level2" data-number="3.3">
<h2 data-number="3.3"><span class="header-section-number">3.3</span> Anzahl Personden, die im Beobachtungszeitraum gestorben sind</h2>
<p>Wie viele Personen sind im Beobachtungszeitraum gestorben?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">table</span>(df<span class="sc">$</span>dead)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
 63 165 </code></pre>
</div>
</div>
</section>
<section id="kreuztabelle-geschlecht-und-überleben" class="level2" data-number="3.4">
<h2 data-number="3.4"><span class="header-section-number">3.4</span> Kreuztabelle Geschlecht und Überleben</h2>
<p>Wie viel Prozent der Frauen und wie viel Prozent der Männer sind im Beobachtungszeitraum gestorben?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">group_by</span>(female) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-4"><a href="#cb16-4"></a>    <span class="at">total =</span> <span class="fu">n</span>(),                           <span class="co"># Gesamtanzahl je Geschlecht</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(dead <span class="sc">==</span> <span class="dv">1</span>),             <span class="co"># Anzahl der gestorbenen Personen</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="at">percent_deaths =</span> (deaths <span class="sc">/</span> total) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Prozentsatz der Gestorbenen</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">arrange</span>(female) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source type="application/json">
{"columns":[{"label":["female"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["total"],"name":[2],"type":["int"],"align":["right"]},{"label":["deaths"],"name":[3],"type":["int"],"align":["right"]},{"label":["percent_deaths"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"138","3":"112","4":"81.15942"},{"1":"1","2":"90","3":"53","4":"58.88889"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="ereignisdatenanalyse" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Ereignisdatenanalyse</h1>
<section id="zensierung" class="level2" data-number="4.1">
<h2 data-number="4.1"><span class="header-section-number">4.1</span> Zensierung</h2>
<p>Wie viele rechtszensierte und wie viele linkszentrierte Beobachtungen liegen vor?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">table</span>(df<span class="sc">$</span>dead)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
 63 165 </code></pre>
</div>
</div>
</section>
<section id="erste-10-fälle" class="level2" data-number="4.2">
<h2 data-number="4.2"><span class="header-section-number">4.2</span> Erste 10 Fälle</h2>
<p>Schauen wir uns die ersten 10 Fälle des Datensatzes an. Was bedeutet das + hinter einer Zahl?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">Surv</span>(df<span class="sc">$</span>time, df<span class="sc">$</span>dead)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  306   455  1010+  210   883  1022+  310   361   218   166 </code></pre>
</div>
</div>
<p>Das + bedeutet, dass es sich um rechtszensierte Fälle handelt. Diese Personen leben zum Ende des Beobachtungszeintraums noch.</p>
<p>Was ist wohl der Nullpunkt der Zeitvariable <em>time</em>?</p>
</section>
<section id="kaplan-meier-kurve" class="level2" data-number="4.3">
<h2 data-number="4.3"><span class="header-section-number">4.3</span> Kaplan-Meier-Kurve</h2>
<p>Erstelle eine Kaplan-Meier-Kurve.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="3_uebungsblatt_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kaplan-meier-kurve-mit-ki" class="level2" data-number="4.4">
<h2 data-number="4.4"><span class="header-section-number">4.4</span> Kaplan-Meier-Kurve mit KI</h2>
<p>Nun ergänze die Kurve mit einem Konfidenzintervall.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  )<span class="sc">+</span> </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">add_confidence_interval</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="3_uebungsblatt_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kaplan-meier-kurve-mit-ki-und-risikotabelle" class="level2" data-number="4.5">
<h2 data-number="4.5"><span class="header-section-number">4.5</span> Kaplan-Meier-Kurve mit Ki und Risikotabelle</h2>
<p>Und nun füge bitte noch eine Risikotabelle hinzu.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>  )<span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">add_confidence_interval</span>() <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">add_risktable</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="3_uebungsblatt_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
<p>Wie viele Personen leben nach 500 Tagen noch?</p>
</section>
<section id="schätzung-der-überlebensrate-nach-einem-jahr" class="level2" data-number="4.6">
<h2 data-number="4.6"><span class="header-section-number">4.6</span> Schätzung der Überlebensrate nach einem Jahr</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df), <span class="at">times =</span> <span class="dv">365</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, dead) ~ 1, data = df)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
  365     65     121    0.409  0.0358        0.345        0.486</code></pre>
</div>
</div>
<p>Wir stellen fest, dass die 1-Jahres-Überlebenswahrscheinlichkeit in dieser Studie 41% beträgt.</p>
</section>
</section>
<section id="überlebenszeit-im-median" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Überlebenszeit im Median</h1>
<p>Wie viele Tage übleben die PatientInnen im Median?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">survfit</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, dead) ~ 1, data = df)

       n events median 0.95LCL 0.95UCL
[1,] 228    165    310     285     363</code></pre>
</div>
</div>
</section>
<section id="kaplan-meier-kurve-nach-geschlecht" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Kaplan-Meier-Kurve nach Geschlecht</h1>
<p>Nun möchten wir die Geschlechterunterschiede in der Überlebenswahrscheinlichkeit über die Zeit graphisch untersuchen.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> female, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span>,</span>
<span id="cb28-6"><a href="#cb28-6"></a>    <span class="at">color =</span> <span class="st">&quot;Geschlecht&quot;</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>  )<span class="sc">+</span> </span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="fu">add_confidence_interval</span>() <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="fu">add_risktable</span>() <span class="sc">+</span> </span>
<span id="cb28-10"><a href="#cb28-10"></a> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="st">&#39;darkred&#39;</span>),  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Männer&quot;</span>, <span class="st">&quot;Frauen&quot;</span>) ) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="st">&#39;darkred&#39;</span>),  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Männer&quot;</span>, <span class="st">&quot;Frauen&quot;</span>) ) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure>
<p><img src="3_uebungsblatt_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cox-proportional-hazards-model" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Cox Proportional Hazards Model</h1>
<p>Nun schätzen wir ein Cox Proportional Hazards Model. Gibt es signifikante Geschlechterunterschiede? Ist die Proportionalitätsannahme erfüllt?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>model1 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> female, <span class="at">data =</span> df)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, dead) ~ female, data = df)

  n= 228, number of events= 165 

          coef exp(coef) se(coef)      z Pr(&gt;|z|)   
female -0.5310    0.5880   0.1672 -3.176  0.00149 **
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

       exp(coef) exp(-coef) lower .95 upper .95
female     0.588      1.701    0.4237     0.816

Concordance= 0.579  (se = 0.021 )
Likelihood ratio test= 10.63  on 1 df,   p=0.001
Wald test            = 10.09  on 1 df,   p=0.001
Score (logrank) test = 10.33  on 1 df,   p=0.001</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">cox.zph</span>(model1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       chisq df     p
female  2.86  1 0.091
GLOBAL  2.86  1 0.091</code></pre>
</div>
</div>
<p>Erstelle eine Tabelle zur besseren Übersicht</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource r cell-code number-lines"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">tab_model</span>(model1,</span>
<span id="cb33-2"><a href="#cb33-2"></a>          <span class="at">show.ci =</span> <span class="cn">FALSE</span>, <span class="at">p.style =</span> <span class="st">&quot;stars&quot;</span>,</span>
<span id="cb33-3"><a href="#cb33-3"></a>          <span class="at">string.se =</span> <span class="st">&quot;se&quot;</span>, <span class="at">string.est =</span> <span class="st">&quot;HR&quot;</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>          <span class="at">string.pred =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top" data-quarto-postprocess="true" style="border-collapse:collapse; border:none;">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;"> </td>
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Surv(time, dead)</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;"></td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">HR</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">female</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.59 <sup>**</sup></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">228</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Nagelkerke</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.046</td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: right; font-style: italic; border-top: double black;">* p&lt;0.05   ** p&lt;0.01   *** p&lt;0.001</td>
</tr>
</tbody>
</table>


</div>
</div>
<section id="interpretiere-den-koeffizienten-von-female" class="level2" data-number="7.1">
<h2 data-number="7.1"><span class="header-section-number">7.1</span> Interpretiere den Koeffizienten von <em>female</em>:</h2>
<p>Bei einem Cox-Regressionsmodell interessieren wir uns meist für die Hazard Ratio (HR). Die HR stellt das Verhältnis der Risiken zwischen zwei Gruppen zu einem bestimmten Zeitpunkt dar. Die HR wird als die momentane Rate des Auftretens des interessierenden Ereignisses bei denjenigen interpretiert, die noch ein Risiko für dieses Ereignis haben. Die HR ist exp(β).</p>
<ul>
<li>HR &lt; 1: verringertes Sterberisiko</li>
<li>HR &gt; 1: erhöhtes Sterberisiko</li>
</ul>
<p>HR = 0,59: Zu einem bestimmten Zeitpunkt sterben 0,59 mal so viele Frauen wie Männer. Frauen haben in dieser Stichprobe ein deutlich geringeres Sterberisiko als Männer.</p>
</section>
</section>
<section id="render" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Render</h1>
<p>Wandle dieses Dokument in ein PDF und ein HTML Dokument um.</p>
</section>
<section id="weiterführende-literatur" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Weiterführende Literatur</h1>
<ul>
<li><a href="https://r4ds.had.co.nz/">R for Data Science</a></li>
<li><a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html</a></li>
</ul>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyLXRpdGxl">Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1uYXZiYXItdGl0bGU=">Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1wcmV2">3 - Seminar (Ereignisdaten)</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9pbmRleC5odG1sS3Vyc2luZm9ybWF0aW9uZW4=">Kursinformationen</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOnF1YXJ0by1zaWRlYmFyLXNlY3Rpb24tMQ==">Zeitplan und Dateien</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9zY2hlZHVsZS5odG1sw5xiZXJzaWNodA==">Übersicht</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9zbGlkZXMvMV9zZW1pbmFyLmh0bWwxLS0tU2VtaW5hcg==">1 - Seminar</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9zbGlkZXMvMV91ZWJ1bmcuaHRtbDEtLS3DnGJ1bmc=">1 - Übung</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi91ZWJ1bmdlbi8xX3VlYnVuZ3NibGF0dC5odG1sMS0tLcOcYnVuZ3NibGF0dA==">1 - Übungsblatt</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9zbGlkZXMvMl9zZW1pbmFyLmh0bWwyLS0tU2VtaW5hci0tKFBhbmVsZGF0ZW4p">2 - Seminar (Paneldaten)</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi91ZWJ1bmdlbi8yX3VlYnVuZ3NibGF0dC5odG1sMi0tLcOcYnVuZ3NibGF0dC0oUGFuZWxkYXRlbik=">2 - Übungsblatt (Paneldaten)</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi9zbGlkZXMvM19zZW1pbmFyLmh0bWwzLS0tU2VtaW5hci0tKEVyZWlnbmlzZGF0ZW4p">3 - Seminar (Ereignisdaten)</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWludC1zaWRlYmFyOi91ZWJ1bmdlbi8zX3VlYnVuZ3NibGF0dC5odG1sMy0tLcOcYnVuZ3NibGF0dC0oRXJlaWduaXNkYXRlbik=">3 - Übungsblatt (Ereignisdaten)</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWJyZWFkY3J1bWJzLVplaXRwbGFuLXVuZC1EYXRlaWVu">Zeitplan und Dateien</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLWJyZWFkY3J1bWJzLTMtLS3DnGJ1bmdzYmxhdHQtKEVyZWlnbmlzZGF0ZW4p">3 - Übungsblatt (Ereignisdaten)</span></p>
<div class="hidden quarto-markdown-envelope-contents" data-render-id="Zm9vdGVyLWxlZnQ=">
<p>© Copyright 2024, Daria Tisch</p>
</div>
<div class="hidden quarto-markdown-envelope-contents" data-render-id="Zm9vdGVyLXJpZ2h0">
<p>This page is built with 💙 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW1ldGF0aXRsZQ==">3. Übungsblatt (Ereignisdatenanalyse) – Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLXR3aXR0ZXJjYXJkdGl0bGU=">3. Übungsblatt (Ereignisdatenanalyse) – Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW9nY2FyZHRpdGxl">3. Übungsblatt (Ereignisdatenanalyse) – Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW1ldGFzaXRlbmFtZQ==">Fortgeschrittene quantitative Methoden</span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLXR3aXR0ZXJjYXJkZGVzYw=="></span> <span class="hidden quarto-markdown-envelope-contents" data-render-id="cXVhcnRvLW9nY2FyZGRkZXNj"></span></p>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="an">title:</span><span class="co"> &quot;3. Übungsblatt (Ereignisdatenanalyse)&quot;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="an">author:</span><span class="co"> &quot;Daria Tisch&quot;</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">  html:</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">    code-fold: true</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">    code-tools: true</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">    code-link: true</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">    df-print: paged</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co">  pdf: default</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb34-14"><a href="#cb34-14"></a><span class="co">---</span></span>
<span id="cb34-15"><a href="#cb34-15"></a></span>
<span id="cb34-16"><a href="#cb34-16"></a><span class="fu"># Organisation</span></span>
<span id="cb34-17"><a href="#cb34-17"></a></span>
<span id="cb34-18"><a href="#cb34-18"></a><span class="fu">## Arbeitsverzeichnis festsetzen</span></span>
<span id="cb34-19"><a href="#cb34-19"></a></span>
<span id="cb34-20"><a href="#cb34-20"></a>quarto-executable-code-5450563D</span>
<span id="cb34-21"><a href="#cb34-21"></a></span>
<span id="cb34-22"><a href="#cb34-22"></a><span class="in">```r</span></span>
<span id="cb34-23"><a href="#cb34-23"></a><span class="co"># set working directory</span></span>
<span id="cb34-24"><a href="#cb34-24"></a><span class="fu">setwd</span>(<span class="st">&quot;C:/Users/ti/Local/seafile/main/teaching/2024_wuppertal/studis/uebungen&quot;</span>)</span>
<span id="cb34-25"><a href="#cb34-25"></a><span class="in">```</span></span>
<span id="cb34-26"><a href="#cb34-26"></a></span>
<span id="cb34-27"><a href="#cb34-27"></a><span class="fu">## Packages installieren und laden</span></span>
<span id="cb34-28"><a href="#cb34-28"></a></span>
<span id="cb34-29"><a href="#cb34-29"></a>quarto-executable-code-5450563D</span>
<span id="cb34-30"><a href="#cb34-30"></a></span>
<span id="cb34-31"><a href="#cb34-31"></a><span class="in">```r</span></span>
<span id="cb34-32"><a href="#cb34-32"></a><span class="co">#| echo: true</span></span>
<span id="cb34-33"><a href="#cb34-33"></a><span class="co">#| results: &quot;hide&quot;</span></span>
<span id="cb34-34"><a href="#cb34-34"></a><span class="co">#| warning: false</span></span>
<span id="cb34-35"><a href="#cb34-35"></a><span class="co"># Packages</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>pkgs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-37"><a href="#cb34-37"></a>  <span class="st">&quot;tidyverse&quot;</span>,</span>
<span id="cb34-38"><a href="#cb34-38"></a>  <span class="st">&quot;sjPlot&quot;</span>, <span class="co"># nice html tables</span></span>
<span id="cb34-39"><a href="#cb34-39"></a>  <span class="st">&quot;survival&quot;</span>, <span class="co"># survival analysis</span></span>
<span id="cb34-40"><a href="#cb34-40"></a>  <span class="st">&quot;ggsurvfit&quot;</span> <span class="co"># flexible time-to-event figures</span></span>
<span id="cb34-41"><a href="#cb34-41"></a>) </span>
<span id="cb34-42"><a href="#cb34-42"></a></span>
<span id="cb34-43"><a href="#cb34-43"></a><span class="do">## Install uninstalled packages</span></span>
<span id="cb34-44"><a href="#cb34-44"></a><span class="fu">lapply</span>(pkgs[<span class="sc">!</span>(pkgs <span class="sc">%in%</span> <span class="fu">installed.packages</span>())], install.packages)</span>
<span id="cb34-45"><a href="#cb34-45"></a></span>
<span id="cb34-46"><a href="#cb34-46"></a><span class="do">## Load all packages to library</span></span>
<span id="cb34-47"><a href="#cb34-47"></a><span class="fu">lapply</span>(pkgs, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-48"><a href="#cb34-48"></a></span>
<span id="cb34-49"><a href="#cb34-49"></a><span class="in">```</span></span>
<span id="cb34-50"><a href="#cb34-50"></a></span>
<span id="cb34-51"><a href="#cb34-51"></a><span class="fu">## Daten einlesen</span></span>
<span id="cb34-52"><a href="#cb34-52"></a></span>
<span id="cb34-53"><a href="#cb34-53"></a>Wir arbeiten mit einem Datensatz, der Teil des R-Pakets {survival} ist. Bitte lasse Dir alle Datensätze des Pakets anzeigen und speichere den Datensatz lung als *df*.</span>
<span id="cb34-54"><a href="#cb34-54"></a></span>
<span id="cb34-55"><a href="#cb34-55"></a>Datensätze, die im Package survival enthalten sind, anzeigen:</span>
<span id="cb34-56"><a href="#cb34-56"></a></span>
<span id="cb34-57"><a href="#cb34-57"></a>quarto-executable-code-5450563D</span>
<span id="cb34-58"><a href="#cb34-58"></a></span>
<span id="cb34-59"><a href="#cb34-59"></a><span class="in">```r</span></span>
<span id="cb34-60"><a href="#cb34-60"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">&quot;survival&quot;</span>)</span>
<span id="cb34-61"><a href="#cb34-61"></a><span class="in">```</span></span>
<span id="cb34-62"><a href="#cb34-62"></a></span>
<span id="cb34-63"><a href="#cb34-63"></a>*lung* Datensatz als *df* speichern:</span>
<span id="cb34-64"><a href="#cb34-64"></a></span>
<span id="cb34-65"><a href="#cb34-65"></a>quarto-executable-code-5450563D</span>
<span id="cb34-66"><a href="#cb34-66"></a></span>
<span id="cb34-67"><a href="#cb34-67"></a><span class="in">```r</span></span>
<span id="cb34-68"><a href="#cb34-68"></a><span class="co"># Lungenkrebsdatensatz als df speichern </span></span>
<span id="cb34-69"><a href="#cb34-69"></a>df <span class="ot">=</span> lung</span>
<span id="cb34-70"><a href="#cb34-70"></a><span class="in">```</span></span>
<span id="cb34-71"><a href="#cb34-71"></a></span>
<span id="cb34-72"><a href="#cb34-72"></a>Schaue Dir nun die Beschreibung des Datensatzes an:</span>
<span id="cb34-73"><a href="#cb34-73"></a></span>
<span id="cb34-74"><a href="#cb34-74"></a>quarto-executable-code-5450563D</span>
<span id="cb34-75"><a href="#cb34-75"></a></span>
<span id="cb34-76"><a href="#cb34-76"></a><span class="in">```r</span></span>
<span id="cb34-77"><a href="#cb34-77"></a>?lung</span>
<span id="cb34-78"><a href="#cb34-78"></a><span class="in">```</span></span>
<span id="cb34-79"><a href="#cb34-79"></a></span>
<span id="cb34-80"><a href="#cb34-80"></a>Der Datensatz enthält also Informationen zu PatientInnen der North Central Cancer Treatment Group.</span>
<span id="cb34-81"><a href="#cb34-81"></a></span>
<span id="cb34-82"><a href="#cb34-82"></a><span class="fu"># Datenaufbereitung</span></span>
<span id="cb34-83"><a href="#cb34-83"></a></span>
<span id="cb34-84"><a href="#cb34-84"></a>In dieser Übung möchten wir untersuchen, ob es Unterschiede zwischen Männern und Frauen in der Überlebenszeit bei Lungenkrebs gibt.</span>
<span id="cb34-85"><a href="#cb34-85"></a></span>
<span id="cb34-86"><a href="#cb34-86"></a>Wir brauchen für unsere Analyse daher die folgenden 3 Variablen:</span>
<span id="cb34-87"><a href="#cb34-87"></a></span>
<span id="cb34-88"><a href="#cb34-88"></a><span class="ss">-   </span>dead (0: lebend, 1: tot)</span>
<span id="cb34-89"><a href="#cb34-89"></a><span class="ss">-   </span>female (0: männlich, 1: weiblich)</span>
<span id="cb34-90"><a href="#cb34-90"></a><span class="ss">-   </span>time (Tage)</span>
<span id="cb34-91"><a href="#cb34-91"></a></span>
<span id="cb34-92"><a href="#cb34-92"></a>Bitte suche diese heraus oder erstelle sie.</span>
<span id="cb34-93"><a href="#cb34-93"></a></span>
<span id="cb34-94"><a href="#cb34-94"></a>quarto-executable-code-5450563D</span>
<span id="cb34-95"><a href="#cb34-95"></a></span>
<span id="cb34-96"><a href="#cb34-96"></a><span class="in">```r</span></span>
<span id="cb34-97"><a href="#cb34-97"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb34-98"><a href="#cb34-98"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-99"><a href="#cb34-99"></a>    <span class="at">dead =</span> <span class="fu">recode</span>(status, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb34-100"><a href="#cb34-100"></a>    <span class="at">female =</span> <span class="fu">recode</span>(sex, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)</span>
<span id="cb34-101"><a href="#cb34-101"></a>  )</span>
<span id="cb34-102"><a href="#cb34-102"></a><span class="in">```</span></span>
<span id="cb34-103"><a href="#cb34-103"></a></span>
<span id="cb34-104"><a href="#cb34-104"></a><span class="fu"># Datenexploration</span></span>
<span id="cb34-105"><a href="#cb34-105"></a></span>
<span id="cb34-106"><a href="#cb34-106"></a><span class="fu">## Anzahl Beobachtungen</span></span>
<span id="cb34-107"><a href="#cb34-107"></a></span>
<span id="cb34-108"><a href="#cb34-108"></a>Wie viele Personen sind in dem Datensatz?</span>
<span id="cb34-109"><a href="#cb34-109"></a></span>
<span id="cb34-110"><a href="#cb34-110"></a>quarto-executable-code-5450563D</span>
<span id="cb34-111"><a href="#cb34-111"></a></span>
<span id="cb34-112"><a href="#cb34-112"></a><span class="in">```r</span></span>
<span id="cb34-113"><a href="#cb34-113"></a><span class="fu">length</span>(df<span class="sc">$</span>dead)</span>
<span id="cb34-114"><a href="#cb34-114"></a></span>
<span id="cb34-115"><a href="#cb34-115"></a><span class="fu">nrow</span>(lung)</span>
<span id="cb34-116"><a href="#cb34-116"></a><span class="in">```</span></span>
<span id="cb34-117"><a href="#cb34-117"></a></span>
<span id="cb34-118"><a href="#cb34-118"></a><span class="fu">## Anzahl Frauen und Männer</span></span>
<span id="cb34-119"><a href="#cb34-119"></a></span>
<span id="cb34-120"><a href="#cb34-120"></a>Wie viele Frauen und Männer sind jewils in dem Datensatz?</span>
<span id="cb34-121"><a href="#cb34-121"></a></span>
<span id="cb34-122"><a href="#cb34-122"></a>quarto-executable-code-5450563D</span>
<span id="cb34-123"><a href="#cb34-123"></a></span>
<span id="cb34-124"><a href="#cb34-124"></a><span class="in">```r</span></span>
<span id="cb34-125"><a href="#cb34-125"></a><span class="fu">table</span>(df<span class="sc">$</span>female)</span>
<span id="cb34-126"><a href="#cb34-126"></a><span class="in">```</span></span>
<span id="cb34-127"><a href="#cb34-127"></a></span>
<span id="cb34-128"><a href="#cb34-128"></a><span class="fu">## Anzahl Personden, die im Beobachtungszeitraum gestorben sind</span></span>
<span id="cb34-129"><a href="#cb34-129"></a></span>
<span id="cb34-130"><a href="#cb34-130"></a>Wie viele Personen sind im Beobachtungszeitraum gestorben?</span>
<span id="cb34-131"><a href="#cb34-131"></a></span>
<span id="cb34-132"><a href="#cb34-132"></a>quarto-executable-code-5450563D</span>
<span id="cb34-133"><a href="#cb34-133"></a></span>
<span id="cb34-134"><a href="#cb34-134"></a><span class="in">```r</span></span>
<span id="cb34-135"><a href="#cb34-135"></a><span class="fu">table</span>(df<span class="sc">$</span>dead)</span>
<span id="cb34-136"><a href="#cb34-136"></a><span class="in">```</span></span>
<span id="cb34-137"><a href="#cb34-137"></a></span>
<span id="cb34-138"><a href="#cb34-138"></a><span class="fu">## Kreuztabelle Geschlecht und Überleben</span></span>
<span id="cb34-139"><a href="#cb34-139"></a></span>
<span id="cb34-140"><a href="#cb34-140"></a>Wie viel Prozent der Frauen und wie viel Prozent der Männer sind im Beobachtungszeitraum gestorben?</span>
<span id="cb34-141"><a href="#cb34-141"></a></span>
<span id="cb34-142"><a href="#cb34-142"></a>quarto-executable-code-5450563D</span>
<span id="cb34-143"><a href="#cb34-143"></a></span>
<span id="cb34-144"><a href="#cb34-144"></a><span class="in">```r</span></span>
<span id="cb34-145"><a href="#cb34-145"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb34-146"><a href="#cb34-146"></a>  <span class="fu">group_by</span>(female) <span class="sc">%&gt;%</span></span>
<span id="cb34-147"><a href="#cb34-147"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-148"><a href="#cb34-148"></a>    <span class="at">total =</span> <span class="fu">n</span>(),                           <span class="co"># Gesamtanzahl je Geschlecht</span></span>
<span id="cb34-149"><a href="#cb34-149"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(dead <span class="sc">==</span> <span class="dv">1</span>),             <span class="co"># Anzahl der gestorbenen Personen</span></span>
<span id="cb34-150"><a href="#cb34-150"></a>    <span class="at">percent_deaths =</span> (deaths <span class="sc">/</span> total) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Prozentsatz der Gestorbenen</span></span>
<span id="cb34-151"><a href="#cb34-151"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-152"><a href="#cb34-152"></a>  <span class="fu">arrange</span>(female) </span>
<span id="cb34-153"><a href="#cb34-153"></a><span class="in">```</span></span>
<span id="cb34-154"><a href="#cb34-154"></a></span>
<span id="cb34-155"><a href="#cb34-155"></a><span class="fu"># Ereignisdatenanalyse</span></span>
<span id="cb34-156"><a href="#cb34-156"></a></span>
<span id="cb34-157"><a href="#cb34-157"></a><span class="fu">## Zensierung</span></span>
<span id="cb34-158"><a href="#cb34-158"></a></span>
<span id="cb34-159"><a href="#cb34-159"></a>Wie viele rechtszensierte und wie viele linkszentrierte Beobachtungen liegen vor?</span>
<span id="cb34-160"><a href="#cb34-160"></a></span>
<span id="cb34-161"><a href="#cb34-161"></a>quarto-executable-code-5450563D</span>
<span id="cb34-162"><a href="#cb34-162"></a></span>
<span id="cb34-163"><a href="#cb34-163"></a><span class="in">```r</span></span>
<span id="cb34-164"><a href="#cb34-164"></a><span class="fu">table</span>(df<span class="sc">$</span>dead)</span>
<span id="cb34-165"><a href="#cb34-165"></a><span class="in">```</span></span>
<span id="cb34-166"><a href="#cb34-166"></a></span>
<span id="cb34-167"><a href="#cb34-167"></a><span class="fu">## Erste 10 Fälle</span></span>
<span id="cb34-168"><a href="#cb34-168"></a></span>
<span id="cb34-169"><a href="#cb34-169"></a>Schauen wir uns die ersten 10 Fälle des Datensatzes an. Was bedeutet das + hinter einer Zahl?</span>
<span id="cb34-170"><a href="#cb34-170"></a></span>
<span id="cb34-171"><a href="#cb34-171"></a>quarto-executable-code-5450563D</span>
<span id="cb34-172"><a href="#cb34-172"></a></span>
<span id="cb34-173"><a href="#cb34-173"></a><span class="in">```r</span></span>
<span id="cb34-174"><a href="#cb34-174"></a><span class="fu">Surv</span>(df<span class="sc">$</span>time, df<span class="sc">$</span>dead)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb34-175"><a href="#cb34-175"></a><span class="in">```</span></span>
<span id="cb34-176"><a href="#cb34-176"></a></span>
<span id="cb34-177"><a href="#cb34-177"></a>Das + bedeutet, dass es sich um rechtszensierte Fälle handelt. Diese Personen leben zum Ende des Beobachtungszeintraums noch.</span>
<span id="cb34-178"><a href="#cb34-178"></a></span>
<span id="cb34-179"><a href="#cb34-179"></a>Was ist wohl der Nullpunkt der Zeitvariable *time*?</span>
<span id="cb34-180"><a href="#cb34-180"></a></span>
<span id="cb34-181"><a href="#cb34-181"></a><span class="fu">## Kaplan-Meier-Kurve</span></span>
<span id="cb34-182"><a href="#cb34-182"></a></span>
<span id="cb34-183"><a href="#cb34-183"></a>Erstelle eine Kaplan-Meier-Kurve.</span>
<span id="cb34-184"><a href="#cb34-184"></a></span>
<span id="cb34-185"><a href="#cb34-185"></a>quarto-executable-code-5450563D</span>
<span id="cb34-186"><a href="#cb34-186"></a></span>
<span id="cb34-187"><a href="#cb34-187"></a><span class="in">```r</span></span>
<span id="cb34-188"><a href="#cb34-188"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb34-189"><a href="#cb34-189"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb34-190"><a href="#cb34-190"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-191"><a href="#cb34-191"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb34-192"><a href="#cb34-192"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb34-193"><a href="#cb34-193"></a>  )</span>
<span id="cb34-194"><a href="#cb34-194"></a><span class="in">```</span></span>
<span id="cb34-195"><a href="#cb34-195"></a></span>
<span id="cb34-196"><a href="#cb34-196"></a><span class="fu">## Kaplan-Meier-Kurve mit KI</span></span>
<span id="cb34-197"><a href="#cb34-197"></a></span>
<span id="cb34-198"><a href="#cb34-198"></a>Nun ergänze die Kurve mit einem Konfidenzintervall.</span>
<span id="cb34-199"><a href="#cb34-199"></a></span>
<span id="cb34-200"><a href="#cb34-200"></a>quarto-executable-code-5450563D</span>
<span id="cb34-201"><a href="#cb34-201"></a></span>
<span id="cb34-202"><a href="#cb34-202"></a><span class="in">```r</span></span>
<span id="cb34-203"><a href="#cb34-203"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb34-204"><a href="#cb34-204"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb34-205"><a href="#cb34-205"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-206"><a href="#cb34-206"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb34-207"><a href="#cb34-207"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb34-208"><a href="#cb34-208"></a>  )<span class="sc">+</span> </span>
<span id="cb34-209"><a href="#cb34-209"></a>  <span class="fu">add_confidence_interval</span>()</span>
<span id="cb34-210"><a href="#cb34-210"></a><span class="in">```</span></span>
<span id="cb34-211"><a href="#cb34-211"></a></span>
<span id="cb34-212"><a href="#cb34-212"></a><span class="fu">## Kaplan-Meier-Kurve mit Ki und Risikotabelle</span></span>
<span id="cb34-213"><a href="#cb34-213"></a></span>
<span id="cb34-214"><a href="#cb34-214"></a>Und nun füge bitte noch eine Risikotabelle hinzu.</span>
<span id="cb34-215"><a href="#cb34-215"></a></span>
<span id="cb34-216"><a href="#cb34-216"></a>quarto-executable-code-5450563D</span>
<span id="cb34-217"><a href="#cb34-217"></a></span>
<span id="cb34-218"><a href="#cb34-218"></a><span class="in">```r</span></span>
<span id="cb34-219"><a href="#cb34-219"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb34-220"><a href="#cb34-220"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb34-221"><a href="#cb34-221"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-222"><a href="#cb34-222"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb34-223"><a href="#cb34-223"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span></span>
<span id="cb34-224"><a href="#cb34-224"></a>  )<span class="sc">+</span> </span>
<span id="cb34-225"><a href="#cb34-225"></a>  <span class="fu">add_confidence_interval</span>() <span class="sc">+</span></span>
<span id="cb34-226"><a href="#cb34-226"></a>  <span class="fu">add_risktable</span>()</span>
<span id="cb34-227"><a href="#cb34-227"></a><span class="in">```</span></span>
<span id="cb34-228"><a href="#cb34-228"></a></span>
<span id="cb34-229"><a href="#cb34-229"></a>Wie viele Personen leben nach 500 Tagen noch?</span>
<span id="cb34-230"><a href="#cb34-230"></a></span>
<span id="cb34-231"><a href="#cb34-231"></a><span class="fu">## Schätzung der Überlebensrate nach einem Jahr</span></span>
<span id="cb34-232"><a href="#cb34-232"></a></span>
<span id="cb34-233"><a href="#cb34-233"></a>quarto-executable-code-5450563D</span>
<span id="cb34-234"><a href="#cb34-234"></a></span>
<span id="cb34-235"><a href="#cb34-235"></a><span class="in">```r</span></span>
<span id="cb34-236"><a href="#cb34-236"></a><span class="fu">summary</span>(<span class="fu">survfit</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df), <span class="at">times =</span> <span class="dv">365</span>)</span>
<span id="cb34-237"><a href="#cb34-237"></a><span class="in">```</span></span>
<span id="cb34-238"><a href="#cb34-238"></a></span>
<span id="cb34-239"><a href="#cb34-239"></a>Wir stellen fest, dass die 1-Jahres-Überlebenswahrscheinlichkeit in dieser Studie 41% beträgt.</span>
<span id="cb34-240"><a href="#cb34-240"></a></span>
<span id="cb34-241"><a href="#cb34-241"></a><span class="fu"># Überlebenszeit im Median</span></span>
<span id="cb34-242"><a href="#cb34-242"></a></span>
<span id="cb34-243"><a href="#cb34-243"></a>Wie viele Tage übleben die PatientInnen im Median?</span>
<span id="cb34-244"><a href="#cb34-244"></a></span>
<span id="cb34-245"><a href="#cb34-245"></a>quarto-executable-code-5450563D</span>
<span id="cb34-246"><a href="#cb34-246"></a></span>
<span id="cb34-247"><a href="#cb34-247"></a><span class="in">```r</span></span>
<span id="cb34-248"><a href="#cb34-248"></a><span class="fu">survfit</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> df)</span>
<span id="cb34-249"><a href="#cb34-249"></a><span class="in">```</span></span>
<span id="cb34-250"><a href="#cb34-250"></a></span>
<span id="cb34-251"><a href="#cb34-251"></a><span class="fu"># Kaplan-Meier-Kurve nach Geschlecht</span></span>
<span id="cb34-252"><a href="#cb34-252"></a></span>
<span id="cb34-253"><a href="#cb34-253"></a>Nun möchten wir die Geschlechterunterschiede in der Überlebenswahrscheinlichkeit über die Zeit graphisch untersuchen.</span>
<span id="cb34-254"><a href="#cb34-254"></a></span>
<span id="cb34-255"><a href="#cb34-255"></a>quarto-executable-code-5450563D</span>
<span id="cb34-256"><a href="#cb34-256"></a></span>
<span id="cb34-257"><a href="#cb34-257"></a><span class="in">```r</span></span>
<span id="cb34-258"><a href="#cb34-258"></a><span class="fu">survfit2</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> female, <span class="at">data =</span> df) <span class="sc">%&gt;%</span> </span>
<span id="cb34-259"><a href="#cb34-259"></a>  <span class="fu">ggsurvfit</span>() <span class="sc">+</span></span>
<span id="cb34-260"><a href="#cb34-260"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-261"><a href="#cb34-261"></a>    <span class="at">x =</span> <span class="st">&quot;Tage&quot;</span>,</span>
<span id="cb34-262"><a href="#cb34-262"></a>    <span class="at">y =</span> <span class="st">&quot;Überlebenswahrscheinlichkeit&quot;</span>,</span>
<span id="cb34-263"><a href="#cb34-263"></a>    <span class="at">color =</span> <span class="st">&quot;Geschlecht&quot;</span></span>
<span id="cb34-264"><a href="#cb34-264"></a>  )<span class="sc">+</span> </span>
<span id="cb34-265"><a href="#cb34-265"></a>  <span class="fu">add_confidence_interval</span>() <span class="sc">+</span></span>
<span id="cb34-266"><a href="#cb34-266"></a>  <span class="fu">add_risktable</span>() <span class="sc">+</span> </span>
<span id="cb34-267"><a href="#cb34-267"></a> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="st">&#39;darkred&#39;</span>),  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Männer&quot;</span>, <span class="st">&quot;Frauen&quot;</span>) ) <span class="sc">+</span></span>
<span id="cb34-268"><a href="#cb34-268"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;darkblue&#39;</span>, <span class="st">&#39;darkred&#39;</span>),  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Männer&quot;</span>, <span class="st">&quot;Frauen&quot;</span>) ) <span class="sc">+</span></span>
<span id="cb34-269"><a href="#cb34-269"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb34-270"><a href="#cb34-270"></a><span class="in">```</span></span>
<span id="cb34-271"><a href="#cb34-271"></a></span>
<span id="cb34-272"><a href="#cb34-272"></a><span class="fu"># Cox Proportional Hazards Model</span></span>
<span id="cb34-273"><a href="#cb34-273"></a></span>
<span id="cb34-274"><a href="#cb34-274"></a>Nun schätzen wir ein Cox Proportional Hazards Model. Gibt es signifikante Geschlechterunterschiede? Ist die Proportionalitätsannahme erfüllt?</span>
<span id="cb34-275"><a href="#cb34-275"></a></span>
<span id="cb34-276"><a href="#cb34-276"></a>quarto-executable-code-5450563D</span>
<span id="cb34-277"><a href="#cb34-277"></a></span>
<span id="cb34-278"><a href="#cb34-278"></a><span class="in">```r</span></span>
<span id="cb34-279"><a href="#cb34-279"></a>model1 <span class="ot">=</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, dead) <span class="sc">~</span> female, <span class="at">data =</span> df)</span>
<span id="cb34-280"><a href="#cb34-280"></a><span class="fu">summary</span>(model1)</span>
<span id="cb34-281"><a href="#cb34-281"></a><span class="fu">cox.zph</span>(model1)</span>
<span id="cb34-282"><a href="#cb34-282"></a><span class="in">```</span></span>
<span id="cb34-283"><a href="#cb34-283"></a></span>
<span id="cb34-284"><a href="#cb34-284"></a>Erstelle eine Tabelle zur besseren Übersicht</span>
<span id="cb34-285"><a href="#cb34-285"></a></span>
<span id="cb34-286"><a href="#cb34-286"></a>quarto-executable-code-5450563D</span>
<span id="cb34-287"><a href="#cb34-287"></a></span>
<span id="cb34-288"><a href="#cb34-288"></a><span class="in">```r</span></span>
<span id="cb34-289"><a href="#cb34-289"></a><span class="fu">tab_model</span>(model1,</span>
<span id="cb34-290"><a href="#cb34-290"></a>          <span class="at">show.ci =</span> <span class="cn">FALSE</span>, <span class="at">p.style =</span> <span class="st">&quot;stars&quot;</span>,</span>
<span id="cb34-291"><a href="#cb34-291"></a>          <span class="at">string.se =</span> <span class="st">&quot;se&quot;</span>, <span class="at">string.est =</span> <span class="st">&quot;HR&quot;</span>,</span>
<span id="cb34-292"><a href="#cb34-292"></a>          <span class="at">string.pred =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb34-293"><a href="#cb34-293"></a><span class="in">```</span></span>
<span id="cb34-294"><a href="#cb34-294"></a></span>
<span id="cb34-295"><a href="#cb34-295"></a><span class="fu">## Interpretiere den Koeffizienten von *female*:</span></span>
<span id="cb34-296"><a href="#cb34-296"></a></span>
<span id="cb34-297"><a href="#cb34-297"></a>Bei einem Cox-Regressionsmodell interessieren wir uns meist für die Hazard Ratio (HR). Die HR stellt das Verhältnis der Risiken zwischen zwei Gruppen zu einem bestimmten Zeitpunkt dar. Die HR wird als die momentane Rate des Auftretens des interessierenden Ereignisses bei denjenigen interpretiert, die noch ein Risiko für dieses Ereignis haben. Die HR ist exp(β).</span>
<span id="cb34-298"><a href="#cb34-298"></a></span>
<span id="cb34-299"><a href="#cb34-299"></a><span class="ss">-   </span>HR <span class="sc">\&lt;</span> 1: verringertes Sterberisiko</span>
<span id="cb34-300"><a href="#cb34-300"></a><span class="ss">-   </span>HR <span class="sc">\&gt;</span> 1: erhöhtes Sterberisiko</span>
<span id="cb34-301"><a href="#cb34-301"></a></span>
<span id="cb34-302"><a href="#cb34-302"></a>HR = 0,59: Zu einem bestimmten Zeitpunkt sterben 0,59 mal so viele Frauen wie Männer. Frauen haben in dieser Stichprobe ein deutlich geringeres Sterberisiko als Männer.</span>
<span id="cb34-303"><a href="#cb34-303"></a></span>
<span id="cb34-304"><a href="#cb34-304"></a><span class="fu"># Render</span></span>
<span id="cb34-305"><a href="#cb34-305"></a></span>
<span id="cb34-306"><a href="#cb34-306"></a>Wandle dieses Dokument in ein PDF und ein HTML Dokument um.</span>
<span id="cb34-307"><a href="#cb34-307"></a></span>
<span id="cb34-308"><a href="#cb34-308"></a><span class="fu"># Weiterführende Literatur</span></span>
<span id="cb34-309"><a href="#cb34-309"></a></span>
<span id="cb34-310"><a href="#cb34-310"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.had.co.nz/)</span></span>
<span id="cb34-311"><a href="#cb34-311"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html</span><span class="co">](https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html)</span></span>
<span id="cb34-312"><a href="#cb34-312"></a></span></code></pre></div>
</div>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/slides/3_seminar.html" class="pagination-link" aria-label="3 - Seminar  (Ereignisdaten)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">3 - Seminar  (Ereignisdaten)</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class='footer-contents'>&copy; Copyright 2024, Daria Tisch</div>  
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <div class='footer-contents'>This page is built with 💙 and [Quarto](https://quarto.org/).</div>  
    </div>
  </div>
</footer>

</body>

</html>
